---
# Execution Environment for redundancy testing
# Tests if pip-only installation (no bindep system packages) works
# This validates which bindep entries are truly necessary vs "dead weight"

version: 3

images:
  base_image:
    name: quay.io/centos/centos:stream9

dependencies:
  ansible_core:
    package_pip: ansible-core>=2.15.0
  ansible_runner:
    package_pip: ansible-runner
  galaxy: requirements.yml
  python: requirements.txt
  # Minimal system deps - only essential C libraries
  system: bindep-minimal.txt

options:
  package_manager_path: /usr/bin/dnf

additional_build_steps:
  prepend_base:
    # Enable EPEL and CRB repos
    - RUN dnf install -y epel-release && /usr/bin/crb enable
    # Install only build essentials, let pip handle Python packages
    - RUN dnf install -y python3-pip python3-devel gcc gcc-c++ libffi-devel openssl-devel
  append_final:
    - RUN python3 -c 'from pylibsshext import __full_version__; print(__full_version__)' || echo "pylibssh check will run at runtime"
